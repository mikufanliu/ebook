webpackJsonp([1],{0:function(e,t){},"0VYC":function(e,t){},1:function(e,t){},"1J5s":function(e,t){},"5oTs":function(e,t){},"7D5n":function(e,t){},G1q7:function(e,t){},NHnr:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("7+uW");document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(" html "),t=window.innerWidth/10;t=t>50?50:t,e.style.fontSize=t+"px"});var s={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var n=o("VU/8")({name:"App"},s,!1,function(e){o("1J5s")},null,null).exports,a=o("/ocq"),r=o("I95x"),c=o.n(r),l=o("VXRH"),h={props:{},data:function(){return{ifShowAbout:!1,books:[]}},created:function(){this.setBooks()},methods:{hideAbout:function(){this.ifShowAbout=!1},showAbout:function(){this.ifShowAbout=!this.ifShowAbout},hideDelete:function(e){this.books[e].ifShowDelete=!1},showDelete:function(e){this.books[e].ifShowDelete=!0},deleteBook:function(e){var t=this;this.store.removeItem(e.key).then(function(){console.log("Book is deleted!"),t.books.pop(e)})},getBookMeta:function(e,t){var o=this,i=Object(l.a)(e,{restore:!0});i.loaded.metadata.then(function(e){e.key=t,e.ifShowDelete=!1,i.loaded.cover.then(function(t){null!=t?i.archive.createUrl(t).then(function(t){e.cover=t,o.books.push(e)}):(e.cover="./static/logo.png",o.books.push(e))})})},setBooks:function(){var e=this;this.store.iterate(function(t,o,i){e.getBookMeta(t,o)})},inputNewEpub:function(e){var t=this;if(e.target.files.length){var o=e.target.files[0],i=new FileReader;if(i.readAsArrayBuffer(o),".epub"!=o.name.substr(o.name.indexOf(".")))return console.log(o.name+" is not an epub file!"),void(this.$refs.inputFile.value="");i.onload=function(){var e=i.result;t.store.keys().then(function(i){-1==i.indexOf(o.name)?(t.store.setItem(o.name,e),console.log("add a new book as ArryBuffer to database"),t.getBookMeta(e,o.name)):console.log("not a new book"),t.$refs.inputFile.value=""})}}else console.log("No file selected!")},addBook:function(e){this.$refs.inputFile.click()},clearBooks:function(){this.store.clear(),this.bookCfi.clear(),this.books=[],console.log("cleaned!")},toggleStore:function(){this.$emit("toggleStore")},open:function(e){var t=this;this.store.getItem(e.key).then(function(o){t.$emit("openNewEpub",[o,e.key])}).then(this.toggleStore)}}},u={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("transition",{attrs:{name:"slide-right"}},[o("div",{staticClass:"store"},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.ifShowAbout,expression:"ifShowAbout"}],staticClass:"mask",on:{click:e.hideAbout}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.ifShowAbout,expression:"ifShowAbout"}],staticClass:"about"},[o("div",{staticClass:"info-item"},[o("span",{staticClass:"logo icon-bin"}),e._v(" "),o("span",{staticClass:"text",on:{click:e.clearBooks}},[e._v("清空书架")])]),e._v(" "),o("div",{staticClass:"info-item"},[o("span",{staticClass:"logo icon-yelp"}),e._v(" "),o("span",{staticClass:"text"},[o("a",{attrs:{href:"https://baike.baidu.com/item/ePub/9924958?fr=aladdin"}},[e._v("关于epub")])])]),e._v(" "),o("div",{staticClass:"info-item"},[o("span",{staticClass:"logo icon-github"}),e._v(" "),o("span",{staticClass:"text"},[o("a",{attrs:{href:"https://github.com/mikufanliu/ebook"}},[e._v("开源地址")])])])]),e._v(" "),o("div",{staticClass:"title-wrapper"},[o("div",{staticClass:"left"},[o("span",{staticClass:"icon-person icon",on:{click:e.showAbout}})]),e._v(" "),o("div",{staticClass:"center"},[o("span",{staticClass:"text"},[e._v("EPUB Reader")])]),e._v(" "),o("div",{staticClass:"right"},[o("span",{staticClass:"icon-arrow-right icon",on:{click:e.toggleStore}})])]),e._v(" "),o("div",{staticClass:"book-store"},[e._l(e.books,function(t,i){return o("div",{key:i,staticClass:"book-item",on:{mouseenter:function(t){return e.showDelete(i)},mouseleave:function(t){return e.hideDelete(i)}}},[o("div",{staticClass:"cover"},[o("span",{directives:[{name:"show",rawName:"v-show",value:t.ifShowDelete,expression:"item.ifShowDelete"}],staticClass:"icon-cross delete",on:{click:function(o){return e.deleteBook(t)}}}),e._v(" "),o("img",{staticClass:"book-cover",attrs:{src:t.cover},on:{click:function(o){return e.open(t)}}})]),e._v(" "),o("span",{staticClass:"book-name"},[e._v(e._s(t.title))])])}),e._v(" "),o("div",{staticClass:"book-item"},[o("div",{staticClass:"icon-folder-plus",on:{click:e.addBook}}),e._v(" "),o("input",{ref:"inputFile",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:function(t){return e.inputNewEpub(t)}}}),e._v(" "),o("span",{staticClass:"add-book"},[e._v("点击添加图书")])])],2)])])},staticRenderFns:[]};var d=o("VU/8")(h,u,!1,function(e){o("7D5n")},"data-v-3d232376",null).exports,f=(o("9DG0"),{components:{BookStore:d},data:function(){return{showBookStore:!1,isFullScreen:!1,ifShowBookInfo:!1}},props:{bookInfo:Object,bookProgress:Number,ifTitleAndMenuShow:{type:Boolean,default:!1}},mounted:function(){var e=this;document.onkeydown=function(t){console.log(t),window.navigator.userAgent.toLowerCase().indexOf("chrome")>0?document.body.scrollHeight===window.screen.height&&document.body.scrollWidth===window.screen.width?e.isFullScreen=!0:e.isFullScreen=!1:window.outerHeight===window.screen.height&&window.outerWidth===window.screen.width?e.isFullScreen=!0:e.isFullScreen=!1},c.a.on("change",function(){e.isFullScreen=c.a.isFullscreen})},methods:{storeReadProgress:function(){alert("您已成功保存阅读进度"),this.$emit("storeReadProgress")},showBookInfo:function(){this.ifShowBookInfo=!this.ifShowBookInfo},openNewEpub:function(e){this.$emit("openNewEpub",e)},toggleStore:function(){this.showBookStore=!this.showBookStore},toggleFullScreen:function(){if(!c.a.enabled)return this.$message({message:"Your browser does not work",type:"warning"}),!1;c.a.toggle()}}}),v={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"title-bar"},[o("transition",{attrs:{name:"slide-down"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.ifTitleAndMenuShow,expression:"ifTitleAndMenuShow"}],staticClass:"title-wrapper"},[o("div",{staticClass:"left"},[o("span",{staticClass:"icon-books icon",on:{click:e.toggleStore}})]),e._v(" "),o("div",{staticClass:"right"},[o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-history icon",on:{click:e.storeReadProgress}})]),e._v(" "),o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-file-text icon",on:{click:e.showBookInfo}})]),e._v(" "),o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon",class:[e.isFullScreen?"icon-shrink":"icon-enlarge"],on:{click:e.toggleFullScreen}})])])])]),e._v(" "),o("book-store",{directives:[{name:"show",rawName:"v-show",value:e.showBookStore,expression:"showBookStore"}],attrs:{bookProgress:e.bookProgress},on:{openNewEpub:e.openNewEpub,toggleStore:e.toggleStore}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.ifShowBookInfo,expression:"ifShowBookInfo"}],staticClass:"content-mask",on:{click:e.showBookInfo}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.ifShowBookInfo,expression:"ifShowBookInfo"}],staticClass:"info-content"},[o("div",{staticClass:"book-cover"},[o("img",{staticClass:"cover",attrs:{src:this.bookInfo.cover}})]),e._v(" "),o("div",{staticClass:"meta-info"},e._l(e.bookInfo,function(t,i){return o("div",{directives:[{name:"show",rawName:"v-show",value:"cover"!=i&&""!=t&&null!=t,expression:"index!='cover'&&item!='' &&item!=null"}],key:i,staticClass:"info-item"},[o("span",{staticClass:"index"},[e._v(e._s(i))]),e._v(" "),o("span",{staticClass:"item"},[e._v(e._s(t))])])}),0)])],1)},staticRenderFns:[]};var p=o("VU/8")(f,v,!1,function(e){o("vw3M")},"data-v-12870da6",null).exports,w={props:{ifShowConten:Boolean,navigation:Object,bookAvailable:Boolean},methods:{jumpTo:function(e){this.$emit("jumpTo",e)}}},g={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("transition",{attrs:{name:"slide-right"}},[o("div",{staticClass:"content"},[e.bookAvailable?o("div",{staticClass:"content-wrapper",attrs:{id:"scrollbar"}},e._l(e.navigation.toc,function(t,i){return o("div",{key:i,staticClass:"content-item",on:{click:function(o){return e.jumpTo(t.href)}}},[o("span",{staticClass:"text"},[e._v(e._s(t.label))])])}),0):o("div",{staticClass:"empty"},[e._v("加载中...")])])])},staticRenderFns:[]};var m={components:{ContentView:o("VU/8")(w,g,!1,function(e){o("5oTs")},"data-v-359bdcf2",null).exports},props:{ifTitleAndMenuShow:{type:Boolean,default:!1},fontSizeList:Array,defaultFontSize:Number,themeList:Array,defaultTheme:Number,bookAvailable:{type:Boolean,default:!1},navigation:Object,bookProgress:Number},data:function(){return{ifSettingShow:!1,showTag:0,progress:0,ifShowContent:!1}},watch:{bookProgress:function(){this.progress=this.bookProgress}},methods:{storeProgress:function(e){this.$emit("storeProgress")},showNav:function(){this.ifShowContent=!this.ifShowContent,this.ifSettingShow=!1},hideContent:function(){this.ifShowContent=!1},jumpTo:function(e){this.$emit("jumpTo",e)},onProgressChange:function(e){this.$emit("onProgressChange",e)},setTheme:function(e){this.$emit("setTheme",e)},setFontSize:function(e){this.$emit("setFontSize",e)},showSetting:function(e){this.showTag===e?this.ifSettingShow=!this.ifSettingShow:(this.ifSettingShow=!0,this.showTag=e)},hideSetting:function(){this.ifSettingShow=!1}}},b={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"menu-bar"},[o("transition",{attrs:{name:"slide-up"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.ifTitleAndMenuShow,expression:"ifTitleAndMenuShow"}],staticClass:"menu-wrapper",class:{"hide-box-shadow":e.ifSettingShow||!e.ifTitleAndMenuShow}},[o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-menu icon",on:{click:function(t){return e.showNav()}}})]),e._v(" "),o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-progress icon",on:{click:function(t){return e.showSetting(2)}}})]),e._v(" "),o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-bright icon",on:{click:function(t){return e.showSetting(1)}}})]),e._v(" "),o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-a icon",on:{click:function(t){return e.showSetting(0)}}},[e._v("A")])])])]),e._v(" "),o("transition",{attrs:{name:"slide-up"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.ifSettingShow,expression:" ifSettingShow"}],staticClass:"setting-wrapper"},[0===e.showTag?o("div",{staticClass:"setting-font-size"},[o("div",{staticClass:"preview",style:{fontSize:e.fontSizeList[0].fontSize+"px"}},[e._v("A")]),e._v(" "),o("div",{staticClass:"select"},e._l(e.fontSizeList,function(t,i){return o("div",{key:i,staticClass:"select-wrapper",on:{click:function(o){return e.setFontSize(t.fontSize)}}},[o("div",{staticClass:"line"}),e._v(" "),o("div",{staticClass:"point-wrapper"},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.defaultFontSize===t.fontSize,expression:"defaultFontSize === item.fontSize"}],staticClass:"point"},[o("div",{staticClass:"small-point"})])]),e._v(" "),o("div",{staticClass:"line"})])}),0),e._v(" "),o("div",{staticClass:"preview",style:{fontSize:e.fontSizeList[e.fontSizeList.length-1].fontSize+"px"}},[e._v("A")])]):1===e.showTag?o("div",{staticClass:"setting-theme"},e._l(e.themeList,function(t,i){return o("div",{key:i,staticClass:"setting-theme-item",on:{click:function(t){return e.setTheme(i)}}},[o("div",{staticClass:"preview",class:{"no-border":"#000"==t.style.body.background},style:{background:t.style.body.background}},[e._v("Aa")]),e._v(" "),o("div",{staticClass:"text",class:{selected:i===e.defaultTheme}},[e._v(e._s(t.name))])])}),0):2===e.showTag?o("div",{staticClass:"setting-progress"},[o("div",{staticClass:"progress-wrapper"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.progress,expression:"progress"}],ref:"progress",staticClass:"progress",style:{backgroundSize:e.progress+"% 100%"},attrs:{type:"range",max:"100",min:"0",step:"1",disabled:!e.bookAvailable},domProps:{value:e.progress},on:{change:function(t){return e.onProgressChange(t.target.value)},__r:function(t){e.progress=t.target.value}}})]),e._v(" "),o("div",{staticClass:"text-wrapper"},[o("span",[e._v(e._s(e.bookAvailable?e.progress+"%":"加载中"))])])]):e._e()])]),e._v(" "),o("content-view",{directives:[{name:"show",rawName:"v-show",value:e.ifShowContent,expression:"ifShowContent"}],attrs:{ifShowContent:e.ifShowContent,navigation:e.navigation,bookAvailable:e.bookAvailable},on:{jumpTo:e.jumpTo}}),e._v(" "),o("transition",{attrs:{name:"fade"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.ifShowContent,expression:"ifShowContent"}],staticClass:"content-mask",on:{click:e.hideContent}})])],1)},staticRenderFns:[]};var k={components:{TitleBar:p,MenuBar:o("VU/8")(m,b,!1,function(e){o("mPg7")},"data-v-c95558c0",null).exports},data:function(){return{bookKey:"deafault",book:null,bookInfo:{},ifTitleAndMenuShow:!0,fontSizeList:[{fontSize:12},{fontSize:14},{fontSize:16},{fontSize:18},{fontSize:20},{fontSize:22},{fontSize:24}],defaultFontSize:16,themeList:[{name:"默认",style:{body:{color:"#000",background:"#fff"}}},{name:"护眼",style:{body:{color:"#000",background:"#ceeaba"}}},{name:"夜间",style:{body:{color:"#fff",background:"#000"}}},{name:"纸张",style:{body:{color:"#000",background:"rgba(241, 236, 226)"}}}],defaultTheme:0,bookAvailable:!1,navigation:{},bookProgress:0,bookSrc:"./static/book1.epub"}},methods:{showProgress:function(){var e=this.rendition.currentLocation();this.bookProgress=this.bookAvailable?this.locations.percentageFromCfi(e.start.cfi):0,this.bookProgress=Math.round(100*this.bookProgress)},jumpTo:function(e){var t=this;this.rendition.display(e).then(function(){t.showProgress()}),this.hideTitleAndMenu()},hideTitleAndMenu:function(){this.ifTitleAndMenuShow=!1,this.$refs.menuBar.hideSetting(),this.$refs.menuBar.hideContent()},onProgressChange:function(e){var t=e/100,o=t>0?this.locations.cfiFromPercentage(t):0;this.rendition.display(o)},setTheme:function(e){this.themes.select(this.themeList[e].name),this.defaultTheme=e},registerTheme:function(){var e=this;this.themeList.forEach(function(t){e.themes.register(t.name,t.style)})},setFontSize:function(e){this.defaultFontSize=e,this.themes&&this.themes.fontSize(e+"px")},toggleTitleAndMenu:function(){this.ifTitleAndMenuShow=!this.ifTitleAndMenuShow,this.ifTitleAndMenuShow||this.$refs.menuBar.hideSetting()},prevPage:function(){var e=this;this.rendition&&this.rendition.prev().then(function(){e.showProgress()})},nextPage:function(){var e=this;this.rendition&&this.rendition.next().then(function(){e.showProgress()})},storeReadProgress:function(){var e=this,t=this.rendition.currentLocation().start.cfi;this.bookCfi.setItem(this.bookKey,t).then(function(){console.log(e.bookKey+"'s read  progress is stored!")})},openNewEpub:function(e){var t=this;this.bookAvailable=!1,this.$refs.menuBar.progress=0;var o=e[0],i=e[1],s=this.rendition.currentLocation().start.cfi,n=null;this.bookCfi.setItem(this.bookKey,s).then(function(){console.log(t.bookKey+" cfi is stored!"),console.log(s),t.bookKey=i,t.bookCfi.getItem(t.bookKey).then(function(e){console.log("get "+t.bookKey+" cfi"),n=e,console.log("current cfi is "+n),null!=t.book&&t.book.destroy(),t.showEpub(o,n)})}).then(function(){})},showEpub:function(e,t){var o=this;console.log(e),this.book=new l.a(e,{restore:!0}),this.rendition=this.book.renderTo("read",{width:"100vw",height:"100vh",method:"default"}),this.book.loaded.metadata.then(function(e){o.book.loaded.cover.then(function(t){null!=t?o.book.archive.createUrl(t).then(function(t){e.cover=t,o.bookInfo=e}):(e.cover="./static/logo.png",o.bookInfo=e)})}),void 0!=t&&null!=t?(console.log("ready to "+t),this.rendition.display(t)):this.rendition.display(),this.themes=this.rendition.themes,this.setFontSize(this.defaultFontSize),this.registerTheme(),this.setTheme(this.defaultTheme),this.book.ready.then(function(){return o.navigation=o.book.navigation,o.book.locations.generate()}).then(function(e){o.locations=o.book.locations,o.bookAvailable=!0,console.log("book available")}).then(function(){o.showProgress()})},handleScroll:function(e){this.$refs.menuBar.ifShowContent||this.$refs.titleBar.showBookStore||this.$refs.titleBar.ifShowBookInfo||(e.deltaY>0?this.nextPage():this.prevPage())}},mounted:function(){this.showEpub(this.bookSrc),window.addEventListener("mousewheel",this.handleScroll,!1),window.addEventListener("DOMMouseScroll",this.handleScroll,!1)}},S={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"ebook"},[o("title-bar",{ref:"titleBar",attrs:{bookProgress:e.bookProgress,ifTitleAndMenuShow:e.ifTitleAndMenuShow,bookInfo:e.bookInfo},on:{storeReadProgress:e.storeReadProgress,openNewEpub:e.openNewEpub}}),e._v(" "),o("div",{staticClass:"read-wrapper"},[o("div",{attrs:{id:"read"}}),e._v(" "),o("div",{staticClass:"mask"},[o("div",{staticClass:"left",on:{click:e.prevPage}}),e._v(" "),o("div",{staticClass:"center",on:{click:e.toggleTitleAndMenu}}),e._v(" "),o("div",{staticClass:"right",on:{click:e.nextPage}})])]),e._v(" "),o("menu-bar",{ref:"menuBar",attrs:{ifTitleAndMenuShow:e.ifTitleAndMenuShow,fontSizeList:e.fontSizeList,defaultFontSize:e.defaultFontSize,themeList:e.themeList,defaultTheme:e.defaultTheme,bookAvailable:e.bookAvailable,navigation:e.navigation,bookProgress:e.bookProgress},on:{setFontSize:e.setFontSize,setTheme:e.setTheme,onProgressChange:e.onProgressChange,jumpTo:e.jumpTo}})],1)},staticRenderFns:[]};var C=o("VU/8")(k,S,!1,function(e){o("0VYC")},"data-v-270b3315",null).exports;i.a.use(a.a);var _=new a.a({routes:[{path:"/",redirect:"/ebook"},{path:"/ebook",component:C}]}),y=o("Rf8U"),A=o.n(y),T=o("mtWM"),B=o.n(T),P=o("22C0"),x=o.n(P);o("jYjM"),o("G1q7");i.a.use(A.a,B.a),i.a.config.productionTip=!1;var z=x.a.createInstance({name:"bookDB"}),F=x.a.createInstance({name:"readProgressDB"});i.a.prototype.store=z,i.a.prototype.bookCfi=F,new i.a({el:"#app",router:_,components:{App:n},template:"<App/>"})},jYjM:function(e,t){},mPg7:function(e,t){},vw3M:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.9bf7572ce54e61cdb038.js.map