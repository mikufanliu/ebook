webpackJsonp([1],{"+ExO":function(e,t){},0:function(e,t){},1:function(e,t){},"1J5s":function(e,t){},G1q7:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("7+uW");document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(" html "),t=window.innerWidth/10;t=t>50?50:t,e.style.fontSize=t+"px"});var i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var s=n("VU/8")({name:"App"},i,!1,function(e){n("1J5s")},null,null).exports,a=n("/ocq"),r=n("I95x"),c=n.n(r),l=n("VXRH"),u={props:{},data:function(){return{bookKey:null,books:[]}},created:function(){this.setBooks()},methods:{getBookMeta:function(e,t){var n=this,o=Object(l.a)(e,{restore:!0});o.loaded.metadata.then(function(e){e.key=t,o.loaded.cover.then(function(t){null!=t?o.archive.createUrl(t).then(function(t){e.cover=t,n.books.push(e)}):(e.cover="/static/logo.png",n.books.push(e))})})},setBooks:function(){var e=this;this.store.iterate(function(t,n,o){e.getBookMeta(t.value,n)}),console.log("set meta")},inputNewEpub:function(e){var t=this;if(console.log("begin"),e.target.files.length){var n=e.target.files[0],o=new FileReader;if(o.readAsArrayBuffer(n),".epub"!=n.name.substr(n.name.indexOf(".")))return console.log(n.name+" is not an epub file!"),void(this.$refs.inputFile.value="");o.onload=function(){var e=o.result;t.store.keys().then(function(o){if(-1==o.indexOf(n.name)){var i={value:e,readProgress:0};t.store.setItem(n.name,i),console.log("add a new book as ArryBuffer to database"),t.getBookMeta(i.value,n.name)}else console.log("not a new book");t.$refs.inputFile.value=""})}}else console.log("No file selected!")},addBook:function(e){this.$refs.inputFile.click()},clearBooks:function(){this.store.clear(),this.books=[],console.log(this.books)},toggleStore:function(){this.$emit("toggleStore")},open:function(e){var t=this;this.store.getItem(e).then(function(e){t.$emit("openNewEpub",e.value)}).then(this.toggleStore)}}},h={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"slide-right"}},[n("div",{staticClass:"store"},[n("div",{staticClass:"title-wrapper"},[n("div",{staticClass:"icon-history icon",on:{click:e.toggleStore}}),e._v(" "),n("div",{staticClass:"icon-floppy-disk icon",on:{click:e.clearBooks}})]),e._v(" "),n("div",{staticClass:"book-store"},[e._l(e.books,function(t,o){return n("div",{key:o,staticClass:"book-item"},[n("img",{staticClass:"book-cover",attrs:{src:t.cover},on:{click:function(n){return e.open(t.key)}}}),e._v(" "),n("span",{staticClass:"book-name"},[e._v(e._s(t.title))])])}),e._v(" "),n("div",{staticClass:"book-item"},[n("span",{staticClass:"icon-folder-plus",on:{click:e.addBook}}),e._v(" "),n("input",{ref:"inputFile",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:function(t){return e.inputNewEpub(t)}}}),e._v(" "),n("span",{staticClass:"add-book"},[e._v("点击添加图书")])])],2)])])},staticRenderFns:[]};var d={components:{BookStore:n("VU/8")(u,h,!1,function(e){n("+ExO")},"data-v-e1a0e328",null).exports},data:function(){return{showBookStore:!0,isFullScreen:!1}},props:{ifTitleAndMenuShow:{type:Boolean,default:!1}},mounted:function(){var e=this;document.onkeydown=function(t){console.log(t),window.navigator.userAgent.toLowerCase().indexOf("chrome")>0?document.body.scrollHeight===window.screen.height&&document.body.scrollWidth===window.screen.width?e.isFullScreen=!0:e.isFullScreen=!1:window.outerHeight===window.screen.height&&window.outerWidth===window.screen.width?e.isFullScreen=!0:e.isFullScreen=!1},c.a.on("change",function(){e.isFullScreen=c.a.isFullscreen})},methods:{openNewEpub:function(e){this.$emit("openNewEpub",e)},toggleStore:function(){this.showBookStore=!this.showBookStore},toggleFullScreen:function(){if(!c.a.enabled)return this.$message({message:"Your browser does not work",type:"warning"}),!1;c.a.toggle()}}},f={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"title-bar"},[n("transition",{attrs:{name:"slide-down"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.ifTitleAndMenuShow,expression:"ifTitleAndMenuShow"}],staticClass:"title-wrapper"},[n("div",{staticClass:"left"},[n("span",{staticClass:"icon-books icon",on:{click:e.toggleStore}})]),e._v(" "),n("div",{staticClass:"right"},[n("div",{staticClass:"icon-wrapper"},[n("span",{staticClass:"icon-cart icon"})]),e._v(" "),n("div",{staticClass:"icon-wrapper"},[n("span",{staticClass:"icon-person icon"})]),e._v(" "),n("div",{staticClass:"icon-wrapper"},[n("span",{staticClass:"icon-more icon"})]),e._v(" "),n("div",{staticClass:"icon-wrapper"},[n("span",{staticClass:"icon",class:[e.isFullScreen?"icon-shrink":"icon-enlarge"],on:{click:e.toggleFullScreen}})])])])]),e._v(" "),n("book-store",{directives:[{name:"show",rawName:"v-show",value:e.showBookStore,expression:"showBookStore"}],on:{openNewEpub:e.openNewEpub,toggleStore:e.toggleStore}})],1)},staticRenderFns:[]};var v=n("VU/8")(d,f,!1,function(e){n("vFDx")},"data-v-5ba4a77c",null).exports,p={props:{ifShowConten:Boolean,navigation:Object,bookAvailable:Boolean},methods:{jumpTo:function(e){this.$emit("jumpTo",e)}}},g={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"slide-right"}},[n("div",{staticClass:"content"},[e.bookAvailable?n("div",{staticClass:"content-wrapper",attrs:{id:"scrollbar"}},e._l(e.navigation.toc,function(t,o){return n("div",{key:o,staticClass:"content-item",on:{click:function(n){return e.jumpTo(t.href)}}},[n("span",{staticClass:"text"},[e._v(e._s(t.label))])])}),0):n("div",{staticClass:"empty"},[e._v("加载中...")])])])},staticRenderFns:[]};var m={components:{ContentView:n("VU/8")(p,g,!1,function(e){n("Qtic")},"data-v-23144600",null).exports},props:{ifTitleAndMenuShow:{type:Boolean,default:!1},fontSizeList:Array,defaultFontSize:Number,themeList:Array,defaultTheme:Number,bookAvailable:{type:Boolean,default:!1},navigation:Object,bookProgress:Number},data:function(){return{ifSettingShow:!1,showTag:0,progress:0,ifShowContent:!1}},watch:{bookProgress:function(){this.progress=this.bookProgress}},methods:{returnISCT:function(){return this.ifShowContent},showNav:function(){this.ifShowContent=!this.ifShowContent,this.ifSettingShow=!1},hideContent:function(){this.ifShowContent=!1},jumpTo:function(e){this.$emit("jumpTo",e)},onProgressChange:function(e){this.$emit("onProgressChange",e)},setTheme:function(e){this.$emit("setTheme",e)},setFontSize:function(e){this.$emit("setFontSize",e)},showSetting:function(e){this.showTag===e?this.ifSettingShow=!this.ifSettingShow:(this.ifSettingShow=!0,this.showTag=e)},hideSetting:function(){this.ifSettingShow=!1}}},w={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"menu-bar"},[n("transition",{attrs:{name:"slide-up"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.ifTitleAndMenuShow,expression:"ifTitleAndMenuShow"}],staticClass:"menu-wrapper",class:{"hide-box-shadow":e.ifSettingShow||!e.ifTitleAndMenuShow}},[n("div",{staticClass:"icon-wrapper"},[n("span",{staticClass:"icon-menu icon",on:{click:function(t){return e.showNav()}}})]),e._v(" "),n("div",{staticClass:"icon-wrapper"},[n("span",{staticClass:"icon-progress icon",on:{click:function(t){return e.showSetting(2)}}})]),e._v(" "),n("div",{staticClass:"icon-wrapper"},[n("span",{staticClass:"icon-bright icon",on:{click:function(t){return e.showSetting(1)}}})]),e._v(" "),n("div",{staticClass:"icon-wrapper"},[n("span",{staticClass:"icon-a icon",on:{click:function(t){return e.showSetting(0)}}},[e._v("A")])])])]),e._v(" "),n("transition",{attrs:{name:"slide-up"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.ifSettingShow,expression:" ifSettingShow"}],staticClass:"setting-wrapper"},[0===e.showTag?n("div",{staticClass:"setting-font-size"},[n("div",{staticClass:"preview",style:{fontSize:e.fontSizeList[0].fontSize+"px"}},[e._v("A")]),e._v(" "),n("div",{staticClass:"select"},e._l(e.fontSizeList,function(t,o){return n("div",{key:o,staticClass:"select-wrapper",on:{click:function(n){return e.setFontSize(t.fontSize)}}},[n("div",{staticClass:"line"}),e._v(" "),n("div",{staticClass:"point-wrapper"},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.defaultFontSize===t.fontSize,expression:"defaultFontSize === item.fontSize"}],staticClass:"point"},[n("div",{staticClass:"small-point"})])]),e._v(" "),n("div",{staticClass:"line"})])}),0),e._v(" "),n("div",{staticClass:"preview",style:{fontSize:e.fontSizeList[e.fontSizeList.length-1].fontSize+"px"}},[e._v("A")])]):1===e.showTag?n("div",{staticClass:"setting-theme"},e._l(e.themeList,function(t,o){return n("div",{key:o,staticClass:"setting-theme-item",on:{click:function(t){return e.setTheme(o)}}},[n("div",{staticClass:"preview",class:{"no-border":"#fff"!==t.style.body.background},style:{background:t.style.body.background}}),e._v(" "),n("div",{staticClass:"text",class:{selected:o===e.defaultTheme}},[e._v(e._s(t.name))])])}),0):2===e.showTag?n("div",{staticClass:"setting-progress"},[n("div",{staticClass:"progress-wrapper"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.progress,expression:"progress"}],ref:"progress",staticClass:"progress",style:{backgroundSize:e.progress+"% 100%"},attrs:{type:"range",max:"100",min:"0",step:"1",disabled:!e.bookAvailable},domProps:{value:e.progress},on:{change:function(t){return e.onProgressChange(t.target.value)},__r:function(t){e.progress=t.target.value}}})]),e._v(" "),n("div",{staticClass:"text-wrapper"},[n("span",[e._v(e._s(e.bookAvailable?e.progress+"%":"加载中"))])])]):e._e()])]),e._v(" "),n("content-view",{directives:[{name:"show",rawName:"v-show",value:e.ifShowContent,expression:"ifShowContent"}],attrs:{ifShowContent:e.ifShowContent,navigation:e.navigation,bookAvailable:e.bookAvailable},on:{jumpTo:e.jumpTo}}),e._v(" "),n("transition",{attrs:{name:"fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.ifShowContent,expression:"ifShowContent"}],staticClass:"content-mask",on:{click:e.hideContent}})])],1)},staticRenderFns:[]};var b={components:{TitleBar:v,MenuBar:n("VU/8")(m,w,!1,function(e){n("VshB")},"data-v-7faf9aba",null).exports},data:function(){return{ifTitleAndMenuShow:!1,fontSizeList:[{fontSize:12},{fontSize:14},{fontSize:16},{fontSize:18},{fontSize:20},{fontSize:22},{fontSize:24}],defaultFontSize:16,themeList:[{name:"default",style:{body:{color:"#000",background:"#fff"}}},{name:"eye",style:{body:{color:"#000",background:"#ceeaba"}}},{name:"night",style:{body:{color:"#fff",background:"#000"}}},{name:"gold",style:{body:{color:"#000",background:"rgba(241, 236, 226)"}}}],defaultTheme:0,bookAvailable:!1,navigation:{},bookProgress:0,bookSrc:"/static/book2.epub"}},methods:{showProgress:function(){var e=this.rendition.currentLocation();this.bookProgress=this.bookAvailable?this.locations.percentageFromCfi(e.start.cfi):0,this.bookProgress=Math.round(100*this.bookProgress)},jumpTo:function(e){var t=this;this.rendition.display(e).then(function(){t.showProgress()}),this.hideTitleAndMenu()},hideTitleAndMenu:function(){this.ifTitleAndMenuShow=!1,this.$refs.menuBar.hideSetting(),this.$refs.menuBar.hideContent()},onProgressChange:function(e){var t=e/100,n=t>0?this.locations.cfiFromPercentage(t):0;this.rendition.display(n)},setTheme:function(e){this.themes.select(this.themeList[e].name),this.defaultTheme=e},registerTheme:function(){var e=this;this.themeList.forEach(function(t){e.themes.register(t.name,t.style)})},setFontSize:function(e){this.defaultFontSize=e,this.themes&&this.themes.fontSize(e+"px")},toggleTitleAndMenu:function(){this.ifTitleAndMenuShow=!this.ifTitleAndMenuShow,this.ifTitleAndMenuShow||this.$refs.menuBar.hideSetting()},prevPage:function(){var e=this;this.rendition&&this.rendition.prev().then(function(){e.showProgress()})},nextPage:function(){var e=this;this.rendition&&this.rendition.next().then(function(){e.showProgress()})},openNewEpub:function(e){var t=document.getElementById("read"),n=document.getElementsByClassName("epub-container");n[0]&&t.removeChild(n[0]),this.showEpub(e)},showEpub:function(e){var t=this;this.book=new l.a(e,{restore:!0}),console.log(this.book),this.rendition=this.book.renderTo("read",{width:"100vw",height:"100vh",method:"default"}),this.rendition.display(),this.themes=this.rendition.themes,this.setFontSize(this.defaultFontSize),this.registerTheme(),this.setTheme(this.defaultTheme),this.book.ready.then(function(){return t.navigation=t.book.navigation,t.book.locations.generate()}).then(function(e){t.locations=t.book.locations,t.bookAvailable=!0})},handleScroll:function(e){!this.$refs.menuBar.returnISCT()&&this.bookAvailable&&(e.deltaY>0?this.nextPage():this.prevPage())}},mounted:function(){this.openNewEpub(this.bookSrc),window.addEventListener("mousewheel",this.handleScroll,!1),window.addEventListener("DOMMouseScroll",this.handleScroll,!1)}},S={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ebook"},[n("title-bar",{attrs:{ifTitleAndMenuShow:e.ifTitleAndMenuShow},on:{openNewEpub:e.openNewEpub}}),e._v(" "),n("div",{staticClass:"read-wrapper"},[n("div",{attrs:{id:"read"}}),e._v(" "),n("div",{staticClass:"mask"},[n("div",{staticClass:"left",on:{click:e.prevPage}}),e._v(" "),n("div",{staticClass:"center",on:{click:e.toggleTitleAndMenu}}),e._v(" "),n("div",{staticClass:"right",on:{click:e.nextPage}})])]),e._v(" "),n("menu-bar",{ref:"menuBar",attrs:{ifTitleAndMenuShow:e.ifTitleAndMenuShow,fontSizeList:e.fontSizeList,defaultFontSize:e.defaultFontSize,themeList:e.themeList,defaultTheme:e.defaultTheme,bookAvailable:e.bookAvailable,navigation:e.navigation,bookProgress:e.bookProgress},on:{setFontSize:e.setFontSize,setTheme:e.setTheme,onProgressChange:e.onProgressChange,jumpTo:e.jumpTo}})],1)},staticRenderFns:[]};var k=n("VU/8")(b,S,!1,function(e){n("mBEu")},"data-v-48cb1ce6",null).exports;o.a.use(a.a);var C=new a.a({routes:[{path:"/",redirect:"/ebook"},{path:"/ebook",component:k}]}),_=n("Rf8U"),T=n.n(_),y=n("mtWM"),A=n.n(y),z=n("22C0"),F=n.n(z);n("jYjM"),n("G1q7");o.a.use(T.a,A.a),o.a.config.productionTip=!1;var B=F.a.createInstance({name:"bookDB"});o.a.prototype.store=B,new o.a({el:"#app",router:C,components:{App:s},template:"<App/>"})},Qtic:function(e,t){},VshB:function(e,t){},jYjM:function(e,t){},mBEu:function(e,t){},vFDx:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.051d1ae8500c0a300ef6.js.map