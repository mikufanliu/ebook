webpackJsonp([1],{0:function(t,e){},"0VYC":function(t,e){},1:function(t,e){},"1J5s":function(t,e){},"5oTs":function(t,e){},"9LaR":function(t,e){},G1q7:function(t,e){},NHnr:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("7+uW");document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector(" html "),e=window.innerWidth/10;e=e>50?50:e,t.style.fontSize=e+"px"});var s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var n=o("VU/8")({name:"App"},s,!1,function(t){o("1J5s")},null,null).exports,a=o("/ocq"),r=o("I95x"),c=o.n(r),l=o("VXRH"),h={props:{},data:function(){return{ifShowAbout:!1,books:[]}},created:function(){this.setBooks()},methods:{hideAbout:function(){this.ifShowAbout=!1},showAbout:function(){this.ifShowAbout=!this.ifShowAbout},hideDelete:function(t){this.books[t].ifShowDelete=!1},showDelete:function(t){this.books[t].ifShowDelete=!0},deleteBook:function(t){var e=this;this.store.removeItem(t.key).then(function(){console.log("Book is deleted!"),e.books.pop(t)})},getBookMeta:function(t,e){var o=this,i=Object(l.a)(t,{restore:!0});i.loaded.metadata.then(function(t){t.key=e,t.ifShowDelete=!1,i.loaded.cover.then(function(e){null!=e?i.archive.createUrl(e).then(function(e){t.cover=e,o.books.push(t)}):(t.cover="./static/logo.png",o.books.push(t))})})},setBooks:function(){var t=this;this.store.iterate(function(e,o,i){t.getBookMeta(e,o)})},inputNewEpub:function(t){var e=this;if(t.target.files.length){var o=t.target.files[0],i=new FileReader;if(i.readAsArrayBuffer(o),".epub"!=o.name.substr(o.name.indexOf(".")))return console.log(o.name+" is not an epub file!"),void(this.$refs.inputFile.value="");i.onload=function(){var t=i.result;e.store.keys().then(function(i){-1==i.indexOf(o.name)?(e.store.setItem(o.name,t),console.log("add a new book as ArryBuffer to database"),e.getBookMeta(t,o.name)):console.log("not a new book"),e.$refs.inputFile.value=""})}}else console.log("No file selected!")},addBook:function(t){this.$refs.inputFile.click()},clearBooks:function(){this.store.clear(),this.bookCfi.clear(),this.books=[],console.log("cleaned!")},toggleStore:function(){this.$emit("toggleStore")},open:function(t){var e=this;this.store.getItem(t.key).then(function(o){e.$emit("openNewEpub",[o,t.key])}).then(this.toggleStore)}}},u={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("transition",{attrs:{name:"slide-right"}},[o("div",{staticClass:"store"},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifShowAbout,expression:"ifShowAbout"}],staticClass:"mask",on:{click:t.hideAbout}}),t._v(" "),o("transition",{attrs:{name:"about"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifShowAbout,expression:"ifShowAbout"}],staticClass:"about"},[o("div",{staticClass:"info-item",on:{click:t.clearBooks}},[o("span",{staticClass:"logo icon-bin"}),t._v(" "),o("span",{staticClass:"text"},[t._v("清空书架")])]),t._v(" "),o("a",{staticClass:"info-item",attrs:{href:"https://baike.baidu.com/item/ePub/9924958?fr=aladdin"}},[o("span",{staticClass:"logo icon-yelp"}),t._v(" "),o("span",{staticClass:"text"},[o("span",[t._v("关于epub")])])]),t._v(" "),o("a",{staticClass:"info-item",attrs:{href:"https://github.com/mikufanliu/ebook"}},[o("span",{staticClass:"logo icon-github"}),t._v(" "),o("span",{staticClass:"text"},[o("span",[t._v("开源地址")])])])])]),t._v(" "),o("div",{staticClass:"title-wrapper"},[o("div",{staticClass:"left"},[o("span",{staticClass:"icon-person icon",on:{click:t.showAbout}})]),t._v(" "),o("div",{staticClass:"center"},[o("span",{staticClass:"text"},[t._v("EPUB Reader")])]),t._v(" "),o("div",{staticClass:"right"},[o("span",{staticClass:"icon-arrow-right icon",on:{click:t.toggleStore}})])]),t._v(" "),o("div",{staticClass:"book-store"},[t._l(t.books,function(e,i){return o("div",{key:i,staticClass:"book-item",on:{mouseenter:function(e){return t.showDelete(i)},mouseleave:function(e){return t.hideDelete(i)}}},[o("div",{staticClass:"cover"},[o("span",{directives:[{name:"show",rawName:"v-show",value:e.ifShowDelete,expression:"item.ifShowDelete"}],staticClass:"icon-cross delete",on:{click:function(o){return t.deleteBook(e)}}}),t._v(" "),o("img",{staticClass:"book-cover",attrs:{src:e.cover},on:{click:function(o){return t.open(e)}}})]),t._v(" "),o("span",{staticClass:"book-name"},[t._v(t._s(e.title))])])}),t._v(" "),o("div",{staticClass:"book-item"},[o("div",{staticClass:"icon-folder-plus",on:{click:t.addBook}}),t._v(" "),o("input",{ref:"inputFile",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:function(e){return t.inputNewEpub(e)}}}),t._v(" "),o("span",{staticClass:"add-book"},[t._v("点击添加图书")])])],2)],1)])},staticRenderFns:[]};var f={components:{BookStore:o("VU/8")(h,u,!1,function(t){o("9LaR")},"data-v-699e518b",null).exports},data:function(){return{showBookStore:!0,isFullScreen:!1,ifShowBookInfo:!1}},props:{bookInfo:Object,bookProgress:Number,ifTitleAndMenuShow:{type:Boolean,default:!1}},mounted:function(){var t=this;document.onkeydown=function(e){console.log(e),window.navigator.userAgent.toLowerCase().indexOf("chrome")>0?document.body.scrollHeight===window.screen.height&&document.body.scrollWidth===window.screen.width?t.isFullScreen=!0:t.isFullScreen=!1:window.outerHeight===window.screen.height&&window.outerWidth===window.screen.width?t.isFullScreen=!0:t.isFullScreen=!1},c.a.on("change",function(){t.isFullScreen=c.a.isFullscreen})},methods:{storeReadProgress:function(){alert("您已成功保存阅读进度"),this.$emit("storeReadProgress")},showBookInfo:function(){this.ifShowBookInfo=!this.ifShowBookInfo},openNewEpub:function(t){this.$emit("openNewEpub",t)},toggleStore:function(){this.showBookStore=!this.showBookStore},toggleFullScreen:function(){if(!c.a.enabled)return this.$message({message:"Your browser does not work",type:"warning"}),!1;c.a.toggle()}}},d={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"title-bar"},[o("transition",{attrs:{name:"slide-down"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifTitleAndMenuShow,expression:"ifTitleAndMenuShow"}],staticClass:"title-wrapper"},[o("div",{staticClass:"left"},[o("span",{staticClass:"icon-books icon",on:{click:t.toggleStore}})]),t._v(" "),o("div",{staticClass:"right"},[o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-history icon",on:{click:t.storeReadProgress}})]),t._v(" "),o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-file-text icon",on:{click:t.showBookInfo}})]),t._v(" "),o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon",class:[t.isFullScreen?"icon-shrink":"icon-enlarge"],on:{click:t.toggleFullScreen}})])])])]),t._v(" "),o("book-store",{directives:[{name:"show",rawName:"v-show",value:t.showBookStore,expression:"showBookStore"}],attrs:{bookProgress:t.bookProgress},on:{openNewEpub:t.openNewEpub,toggleStore:t.toggleStore}}),t._v(" "),o("transition",{attrs:{name:"fade"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifShowBookInfo,expression:"ifShowBookInfo"}],staticClass:"content-mask",on:{click:t.showBookInfo}})]),t._v(" "),o("transition",{attrs:{name:"slide-left"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifShowBookInfo,expression:"ifShowBookInfo"}],staticClass:"info-content"},[o("div",{staticClass:"book-cover"},[o("img",{staticClass:"cover",attrs:{src:this.bookInfo.cover}})]),t._v(" "),o("div",{staticClass:"meta-info"},t._l(t.bookInfo,function(e,i){return o("div",{directives:[{name:"show",rawName:"v-show",value:"cover"!=i&&""!=e&&null!=e,expression:"index!='cover'&&item!='' &&item!=null"}],key:i,staticClass:"info-item"},[o("span",{staticClass:"index"},[t._v(t._s(i))]),t._v(" "),o("span",{staticClass:"item"},[t._v(t._s(e))])])}),0)])])],1)},staticRenderFns:[]};var v=o("VU/8")(f,d,!1,function(t){o("ZwKI")},"data-v-519a147a",null).exports,p={props:{ifShowConten:Boolean,navigation:Object,bookAvailable:Boolean},methods:{jumpTo:function(t){this.$emit("jumpTo",t)}}},w={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("transition",{attrs:{name:"slide-right"}},[o("div",{staticClass:"content"},[t.bookAvailable?o("div",{staticClass:"content-wrapper",attrs:{id:"scrollbar"}},t._l(t.navigation.toc,function(e,i){return o("div",{key:i,staticClass:"content-item",on:{click:function(o){return t.jumpTo(e.href)}}},[o("span",{staticClass:"text"},[t._v(t._s(e.label))])])}),0):o("div",{staticClass:"empty"},[t._v("加载中...")])])])},staticRenderFns:[]};var g={components:{ContentView:o("VU/8")(p,w,!1,function(t){o("5oTs")},"data-v-359bdcf2",null).exports},props:{ifTitleAndMenuShow:{type:Boolean,default:!1},fontSizeList:Array,defaultFontSize:Number,themeList:Array,defaultTheme:Number,bookAvailable:{type:Boolean,default:!1},navigation:Object,bookProgress:Number},data:function(){return{ifSettingShow:!1,showTag:0,progress:0,ifShowContent:!1}},watch:{bookProgress:function(){this.progress=this.bookProgress}},methods:{storeProgress:function(t){this.$emit("storeProgress")},showNav:function(){this.ifShowContent=!this.ifShowContent,this.ifSettingShow=!1},hideContent:function(){this.ifShowContent=!1},jumpTo:function(t){this.$emit("jumpTo",t)},onProgressChange:function(t){this.$emit("onProgressChange",t)},setTheme:function(t){this.$emit("setTheme",t)},setFontSize:function(t){this.$emit("setFontSize",t)},showSetting:function(t){this.showTag===t?this.ifSettingShow=!this.ifSettingShow:(this.ifSettingShow=!0,this.showTag=t)},hideSetting:function(){this.ifSettingShow=!1}}},m={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"menu-bar"},[o("transition",{attrs:{name:"slide-up"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifTitleAndMenuShow,expression:"ifTitleAndMenuShow"}],staticClass:"menu-wrapper",class:{"hide-box-shadow":t.ifSettingShow||!t.ifTitleAndMenuShow}},[o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-menu icon",on:{click:function(e){return t.showNav()}}})]),t._v(" "),o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-progress icon",on:{click:function(e){return t.showSetting(2)}}})]),t._v(" "),o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-bright icon",on:{click:function(e){return t.showSetting(1)}}})]),t._v(" "),o("div",{staticClass:"icon-wrapper"},[o("span",{staticClass:"icon-a icon",on:{click:function(e){return t.showSetting(0)}}},[t._v("A")])])])]),t._v(" "),o("transition",{attrs:{name:"slide-up"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifSettingShow,expression:" ifSettingShow"}],staticClass:"setting-wrapper"},[0===t.showTag?o("div",{staticClass:"setting-font-size"},[o("div",{staticClass:"preview left",style:{fontSize:t.fontSizeList[0].fontSize+"px"}},[t._v("A")]),t._v(" "),o("div",{staticClass:"select"},t._l(t.fontSizeList,function(e,i){return o("div",{key:i,staticClass:"select-wrapper",on:{click:function(o){return t.setFontSize(e.fontSize)}}},[o("div",{staticClass:"line"}),t._v(" "),o("div",{staticClass:"point-wrapper"},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.defaultFontSize===e.fontSize,expression:"defaultFontSize === item.fontSize"}],staticClass:"point"},[o("div",{staticClass:"small-point"})])]),t._v(" "),o("div",{staticClass:"line"})])}),0),t._v(" "),o("div",{staticClass:"preview right",style:{fontSize:t.fontSizeList[t.fontSizeList.length-1].fontSize+"px"}},[t._v("A")])]):1===t.showTag?o("div",{staticClass:"setting-theme"},t._l(t.themeList,function(e,i){return o("div",{key:i,staticClass:"setting-theme-item",on:{click:function(e){return t.setTheme(i)}}},[o("div",{staticClass:"preview",class:{"no-border":"#000"==e.style.body.background},style:{background:e.style.body.background}},[t._v("Aa")]),t._v(" "),o("div",{staticClass:"text",class:{selected:i===t.defaultTheme}},[t._v(t._s(e.name))])])}),0):2===t.showTag?o("div",{staticClass:"setting-progress"},[o("div",{staticClass:"progress-wrapper"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.progress,expression:"progress"}],ref:"progress",staticClass:"progress",style:{backgroundSize:t.progress+"% 100%"},attrs:{type:"range",max:"100",min:"0",step:"1",disabled:!t.bookAvailable},domProps:{value:t.progress},on:{change:function(e){return t.onProgressChange(e.target.value)},__r:function(e){t.progress=e.target.value}}})]),t._v(" "),o("div",{staticClass:"text-wrapper"},[o("span",[t._v(t._s(t.bookAvailable?t.progress+"%":"加载中"))])])]):t._e()])]),t._v(" "),o("content-view",{directives:[{name:"show",rawName:"v-show",value:t.ifShowContent,expression:"ifShowContent"}],attrs:{ifShowContent:t.ifShowContent,navigation:t.navigation,bookAvailable:t.bookAvailable},on:{jumpTo:t.jumpTo}}),t._v(" "),o("transition",{attrs:{name:"fade"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifShowContent,expression:"ifShowContent"}],staticClass:"content-mask",on:{click:t.hideContent}})])],1)},staticRenderFns:[]};var b={components:{TitleBar:v,MenuBar:o("VU/8")(g,m,!1,function(t){o("YWct")},"data-v-1cd0157e",null).exports},data:function(){return{bookKey:"deafault",book:null,bookInfo:{},ifTitleAndMenuShow:!0,fontSizeList:[{fontSize:12},{fontSize:14},{fontSize:16},{fontSize:18},{fontSize:20},{fontSize:22},{fontSize:24}],defaultFontSize:16,themeList:[{name:"默认",style:{body:{color:"#000",background:"#fff"}}},{name:"护眼",style:{body:{color:"#000",background:"#ceeaba"}}},{name:"夜间",style:{body:{color:"#fff",background:"#000"}}},{name:"纸张",style:{body:{color:"#000",background:"rgba(241, 236, 226)"}}}],defaultTheme:0,bookAvailable:!1,navigation:{},bookProgress:0,bookSrc:"./static/book1.epub"}},methods:{showProgress:function(){var t=this.rendition.currentLocation();this.bookProgress=this.bookAvailable?this.locations.percentageFromCfi(t.start.cfi):0,this.bookProgress=Math.round(100*this.bookProgress)},jumpTo:function(t){var e=this;this.rendition.display(t).then(function(){e.showProgress()}),this.hideTitleAndMenu()},hideTitleAndMenu:function(){this.ifTitleAndMenuShow=!1,this.$refs.menuBar.hideSetting(),this.$refs.menuBar.hideContent()},onProgressChange:function(t){var e=t/100,o=e>0?this.locations.cfiFromPercentage(e):0;this.rendition.display(o)},setTheme:function(t){this.themes.select(this.themeList[t].name),this.defaultTheme=t},registerTheme:function(){var t=this;this.themeList.forEach(function(e){t.themes.register(e.name,e.style)})},setFontSize:function(t){this.defaultFontSize=t,this.themes&&this.themes.fontSize(t+"px")},toggleTitleAndMenu:function(){this.ifTitleAndMenuShow=!this.ifTitleAndMenuShow,this.ifTitleAndMenuShow||this.$refs.menuBar.hideSetting()},prevPage:function(){var t=this;this.rendition&&this.rendition.prev().then(function(){t.showProgress()})},nextPage:function(){var t=this;this.rendition&&this.rendition.next().then(function(){t.showProgress()})},storeReadProgress:function(){var t=this,e=this.rendition.currentLocation().start.cfi;this.bookCfi.setItem(this.bookKey,e).then(function(){console.log(t.bookKey+"'s read  progress is stored!")})},openNewEpub:function(t){var e=this;this.bookAvailable=!1,this.$refs.menuBar.progress=0;var o=t[0],i=t[1],s=this.rendition.currentLocation().start.cfi,n=null;this.bookCfi.setItem(this.bookKey,s).then(function(){console.log(e.bookKey+" cfi is stored!"),console.log(s),e.bookKey=i,e.bookCfi.getItem(e.bookKey).then(function(t){console.log("get "+e.bookKey+" cfi"),n=t,console.log("current cfi is "+n),null!=e.book&&e.book.destroy(),e.showEpub(o,n)})}).then(function(){})},showEpub:function(t,e){var o=this;console.log(t),this.book=new l.a(t,{restore:!0}),this.rendition=this.book.renderTo("read",{width:"100vw",height:"100vh",method:"default"}),this.book.loaded.metadata.then(function(t){o.book.loaded.cover.then(function(e){null!=e?o.book.archive.createUrl(e).then(function(e){t.cover=e,o.bookInfo=t}):(t.cover="./static/logo.png",o.bookInfo=t)})}),void 0!=e&&null!=e?(console.log("ready to "+e),this.rendition.display(e)):this.rendition.display(),this.themes=this.rendition.themes,this.setFontSize(this.defaultFontSize),this.registerTheme(),this.setTheme(this.defaultTheme),this.book.ready.then(function(){return o.navigation=o.book.navigation,o.book.locations.generate()}).then(function(t){o.locations=o.book.locations,o.bookAvailable=!0,console.log("book available")}).then(function(){o.showProgress()})},handleScroll:function(t){this.$refs.menuBar.ifShowContent||this.$refs.titleBar.showBookStore||this.$refs.titleBar.ifShowBookInfo||(t.deltaY>0?this.nextPage():this.prevPage())}},mounted:function(){this.showEpub(this.bookSrc),window.addEventListener("mousewheel",this.handleScroll,!1),window.addEventListener("DOMMouseScroll",this.handleScroll,!1)}},k={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"ebook"},[o("title-bar",{ref:"titleBar",attrs:{bookProgress:t.bookProgress,ifTitleAndMenuShow:t.ifTitleAndMenuShow,bookInfo:t.bookInfo},on:{storeReadProgress:t.storeReadProgress,openNewEpub:t.openNewEpub}}),t._v(" "),o("div",{staticClass:"read-wrapper"},[o("div",{attrs:{id:"read"}}),t._v(" "),o("div",{staticClass:"mask"},[o("div",{staticClass:"left",on:{click:t.prevPage}}),t._v(" "),o("div",{staticClass:"center",on:{click:t.toggleTitleAndMenu}}),t._v(" "),o("div",{staticClass:"right",on:{click:t.nextPage}})])]),t._v(" "),o("menu-bar",{ref:"menuBar",attrs:{ifTitleAndMenuShow:t.ifTitleAndMenuShow,fontSizeList:t.fontSizeList,defaultFontSize:t.defaultFontSize,themeList:t.themeList,defaultTheme:t.defaultTheme,bookAvailable:t.bookAvailable,navigation:t.navigation,bookProgress:t.bookProgress},on:{setFontSize:t.setFontSize,setTheme:t.setTheme,onProgressChange:t.onProgressChange,jumpTo:t.jumpTo}})],1)},staticRenderFns:[]};var S=o("VU/8")(b,k,!1,function(t){o("0VYC")},"data-v-270b3315",null).exports;i.a.use(a.a);var C=new a.a({routes:[{path:"/",redirect:"/ebook"},{path:"/ebook",component:S}]}),_=o("Rf8U"),y=o.n(_),A=o("mtWM"),T=o.n(A),B=o("22C0"),P=o.n(B);o("jYjM"),o("G1q7");i.a.use(y.a,T.a),i.a.config.productionTip=!1;var x=P.a.createInstance({name:"bookDB"}),z=P.a.createInstance({name:"readProgressDB"});i.a.prototype.store=x,i.a.prototype.bookCfi=z,new i.a({el:"#app",router:C,components:{App:n},template:"<App/>"})},YWct:function(t,e){},ZwKI:function(t,e){},jYjM:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.ffb8cfa23a8e4374f7db.js.map